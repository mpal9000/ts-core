import test from 'ava'
import { wrapIs, isType, f, nf, npf, nnf, pf } from '../test.js'
import { EPSILON, SMALLEST, MINIMUM, MAXIMUM } from './constants.js'
import { toFixed } from './toFixed.js'

test('toFixed()', (t) => {
  const is: ReturnType<typeof wrapIs> = wrapIs(t)

  isType<string>()(toFixed(20, f()))
  isType<string>()(toFixed(20, nf()))
  isType<string>()(toFixed(20, npf()))
  isType<string>()(toFixed(20, nnf()))
  isType<string>()(toFixed(20, pf()))

  is('-1.7976931348623157e+308', toFixed(3, f(MINIMUM)))
  is('-1.7976931348623157e+308', toFixed(1, f(MINIMUM)))
  is('-1.5', toFixed(1, f(-1.4999999999999998)))
  is('-1.4999999999999998', toFixed(16, f(-1.4999999999999998)))
  is('-1.230', toFixed(3, f(-1.23)))
  is('-1.2', toFixed(1, f(-1.23)))
  is('-1.02', toFixed(2, f(-1.015)))
  is('-1.01', toFixed(2, f(-1.005)))
  is('-1.000', toFixed(3, f(-1.0)))
  is('-1.0', toFixed(1, f(-1.0)))
  is('-1.000', toFixed(3, f(-1)))
  is('-1.0', toFixed(1, f(-1)))
  is('-0.5000000000000001', toFixed(16, f(-0.5000000000000001)))
  is('-0.5', toFixed(1, f(-0.5000000000000001)))
  is('-0.5', toFixed(1, f(-0.49999999999999994)))
  is('-0.49999999999999994', toFixed(17, f(-0.49999999999999994)))
  is('-0.1', toFixed(1, f(-0.1)))
  is('0.00', toFixed(2, f(-1e-8)))
  is('0.000', toFixed(3, f(-EPSILON)))
  is('0.000', toFixed(3, f(-SMALLEST)))
  is('0.000', toFixed(3, f(-0.0)))
  is('0.0', toFixed(1, f(-0.0)))
  is('0.000', toFixed(3, f(-0)))
  is('0.00', toFixed(2, f(-0)))
  is('0.00', toFixed(2, f(0)))
  is('0.000', toFixed(3, f(0)))
  is('0.0', toFixed(1, f(0.0)))
  is('0.000', toFixed(3, f(0.0)))
  is('0.000', toFixed(3, f(SMALLEST)))
  is('0.000', toFixed(3, f(EPSILON)))
  is('0.00', toFixed(2, f(1e-8)))
  is('0.1', toFixed(1, f(0.1)))
  is('0.49999999999999994', toFixed(17, f(0.49999999999999994)))
  is('0.5', toFixed(1, f(0.49999999999999994)))
  is('0.5', toFixed(1, f(0.5000000000000001)))
  is('0.5000000000000001', toFixed(16, f(0.5000000000000001)))
  is('1.0', toFixed(1, f(1)))
  is('1.000', toFixed(3, f(1)))
  is('1.0', toFixed(1, f(1.0)))
  is('1.000', toFixed(3, f(1.0)))
  is('1.01', toFixed(2, f(1.005)))
  is('1.02', toFixed(2, f(1.015)))
  is('1.2', toFixed(1, f(1.23)))
  is('1.230', toFixed(3, f(1.23)))
  is('1.4999999999999998', toFixed(16, f(1.4999999999999998)))
  is('1.5', toFixed(1, f(1.4999999999999998)))
  is('1.7976931348623157e+308', toFixed(1, f(MAXIMUM)))
  is('1.7976931348623157e+308', toFixed(3, f(MAXIMUM)))

  is('-1262.1', toFixed(1, f(-1262.148)))
  is('-65.1', toFixed(1, f(-65.118)))
  is('-46.2', toFixed(1, f(-46.15)))
  is('-42.1', toFixed(1, f(-42.1)))
  is('-39.1', toFixed(1, f(-39.1425)))
  is('-18.1', toFixed(1, f(-18.115)))
  is('-17.1', toFixed(1, f(-17.11)))
  is('-17.1', toFixed(1, f(-17.1)))
  is('-9.1', toFixed(1, f(-9.113)))
  is('-5.1', toFixed(1, f(-5.112)))
  is('-4.2', toFixed(1, f(-4.16)))
  is('-4.2', toFixed(1, f(-4.15)))
  is('-3.2', toFixed(1, f(-3.19)))
  is('-3.2', toFixed(1, f(-3.15)))
  is('-3.1', toFixed(1, f(-3.11)))
  is('-3.1', toFixed(1, f(-3.1)))
  is('-2.2', toFixed(1, f(-2.19)))
  is('-2.2', toFixed(1, f(-2.15)))
  is('-2.1', toFixed(1, f(-2.126)))
  is('-2.1', toFixed(1, f(-2.11755465135353)))
  is('-2.1', toFixed(1, f(-2.1175495134384)))
  is('-2.1', toFixed(1, f(-2.11753543549)))
  is('-2.1', toFixed(1, f(-2.11)))
  is('-2.1', toFixed(1, f(-2.1)))
  is('-1.2', toFixed(1, f(-1.19)))
  is('-1.2', toFixed(1, f(-1.15)))
  is('-1.1', toFixed(1, f(-1.1499999999999998)))
  is('-1.1', toFixed(1, f(-1.149999999999998)))
  is('-1.1', toFixed(1, f(-1.145)))
  is('-1.1', toFixed(1, f(-1.134)))
  is('-1.1', toFixed(1, f(-1.1123456789)))
  is('-1.1', toFixed(1, f(-1.11)))
  is('-1.1', toFixed(1, f(-1.1015)))
  is('-1.1', toFixed(1, f(-1.1005)))
  is('-1.1', toFixed(1, f(-1.10049999)))
  is('-1.1', toFixed(1, f(-1.1)))
  is('-0.2', toFixed(1, f(-0.19)))
  is('-0.2', toFixed(1, f(-0.16)))
  is('-0.2', toFixed(1, f(-0.15000000000000001)))
  is('-0.2', toFixed(1, f(-0.1500000000000001)))
  is('-0.2', toFixed(1, f(-0.15)))
  is('-0.1', toFixed(1, f(-0.14999999999999994)))
  is('-0.1', toFixed(1, f(-0.14)))
  is('-0.1', toFixed(1, f(-0.12)))
  is('-0.1', toFixed(1, f(-0.11)))
  is('-0.1', toFixed(1, f(-0.1014999999999999999)))
  is('-0.1', toFixed(1, f(-0.101499999999999999)))
  is('-0.1', toFixed(1, f(-0.10000001)))
  is('0.0', toFixed(1, f(-1e-8)))
  is('0.0', toFixed(1, f(-0)))
  is('0.0', toFixed(1, f(0)))
  is('0.0', toFixed(1, f(1e-8)))
  is('0.1', toFixed(1, f(0.10000001)))
  is('0.1', toFixed(1, f(0.101499999999999999)))
  is('0.1', toFixed(1, f(0.1014999999999999999)))
  is('0.1', toFixed(1, f(0.11)))
  is('0.1', toFixed(1, f(0.12)))
  is('0.1', toFixed(1, f(0.14)))
  is('0.1', toFixed(1, f(0.14999999999999994)))
  is('0.2', toFixed(1, f(0.15)))
  is('0.2', toFixed(1, f(0.1500000000000001)))
  is('0.2', toFixed(1, f(0.15000000000000001)))
  is('0.2', toFixed(1, f(0.16)))
  is('0.2', toFixed(1, f(0.19)))
  is('1.1', toFixed(1, f(1.1)))
  is('1.1', toFixed(1, f(1.10049999)))
  is('1.1', toFixed(1, f(1.1005)))
  is('1.1', toFixed(1, f(1.1015)))
  is('1.1', toFixed(1, f(1.11)))
  is('1.1', toFixed(1, f(1.1123456789)))
  is('1.1', toFixed(1, f(1.134)))
  is('1.1', toFixed(1, f(1.145)))
  is('1.1', toFixed(1, f(1.149999999999998)))
  is('1.1', toFixed(1, f(1.1499999999999998)))
  is('1.2', toFixed(1, f(1.15)))
  is('1.2', toFixed(1, f(1.19)))
  is('2.1', toFixed(1, f(2.1)))
  is('2.1', toFixed(1, f(2.11)))
  is('2.1', toFixed(1, f(2.11753543549)))
  is('2.1', toFixed(1, f(2.1175495134384)))
  is('2.1', toFixed(1, f(2.11755465135353)))
  is('2.1', toFixed(1, f(2.126)))
  is('2.2', toFixed(1, f(2.15)))
  is('2.2', toFixed(1, f(2.19)))
  is('3.1', toFixed(1, f(3.1)))
  is('3.1', toFixed(1, f(3.11)))
  is('3.2', toFixed(1, f(3.15)))
  is('3.2', toFixed(1, f(3.19)))
  is('4.2', toFixed(1, f(4.15)))
  is('4.2', toFixed(1, f(4.16)))
  is('5.1', toFixed(1, f(5.112)))
  is('9.1', toFixed(1, f(9.113)))
  is('17.1', toFixed(1, f(17.1)))
  is('17.1', toFixed(1, f(17.11)))
  is('18.1', toFixed(1, f(18.115)))
  is('39.1', toFixed(1, f(39.1425)))
  is('42.1', toFixed(1, f(42.1)))
  is('46.2', toFixed(1, f(46.15)))
  is('65.1', toFixed(1, f(65.118)))
  is('1262.1', toFixed(1, f(1262.148)))

  is('-1.7976931348623157e+308', toFixed(1, f(MINIMUM - 10 ** 291)))
  is('-1.7976931348623157e+308', toFixed(20, f(MINIMUM - 10 ** 291)))
  is('-1.7976931348623155e+308', toFixed(1, f(MINIMUM + 10 ** 292)))
  is('-1.7976931348623155e+308', toFixed(20, f(MINIMUM + 10 ** 292)))
  is('-7.976931348623157e+307', toFixed(1, f(MINIMUM + 10 ** 308)))
  is('-7.976931348623157e+307', toFixed(20, f(MINIMUM + 10 ** 308)))
  is('7.976931348623157e+307', toFixed(1, f(MAXIMUM - 10 ** 308)))
  is('7.976931348623157e+307', toFixed(20, f(MAXIMUM - 10 ** 308)))
  is('1.7976931348623155e+308', toFixed(1, f(MAXIMUM - 10 ** 292)))
  is('1.7976931348623155e+308', toFixed(20, f(MAXIMUM - 10 ** 292)))
  is('1.7976931348623157e+308', toFixed(1, f(MAXIMUM + 10 ** 291)))
  is('1.7976931348623157e+308', toFixed(20, f(MAXIMUM + 10 ** 291)))

  // @ts-expect-error
  isType<string>()(toFixed(0, f()))
  // @ts-expect-error
  isType<string>()(toFixed(21, f()))
})
